// class ColumnCacheDataTableBase
//
// Automaticaly generated file
// Generated by: AGRUSERS\bard.hustveit
// Time: 20.04.2007
// Path: D:\dev\src\utils\SqlStudio\SqlExecute\DbSchemaCache

using System;
using System.Collections.Generic;
using System.Text;
using System.Data;
using System.Data.Common;

namespace SqlExecute.DbSchemaCache
{
    public class ColumnCacheDataTableBase : DataTable
    {
        private DbConnection _dbConnection = null;
        private DbDataAdapter _dbAdapter = null;
        private DbProviderFactory _dbFactory = null;
        private string _connectionString = null;

        public ColumnCacheDataTableBase(DbProviderFactory factory, DbConnection connection)
            : base("column_cache")
        {
            this._dbFactory = factory;
            this._dbConnection = connection;
            this.GenerateUpdateDA();
        }

        public ColumnCacheDataTableBase(DbProviderFactory factory, string connectionString)
            : base("column_cache")
        {
            this._dbFactory = factory;
            this._connectionString = connectionString;
            this.GenerateUpdateDA();
        }

        public ColumnCacheDataTableBase(DbProviderFactory factory)
            : base("column_cache")
        {
            this.GenerateUpdateDA();
        }

        private DbConnection GetOpenConnection(string connectionString)
        {
            if (connectionString == null)
                throw new Exception("No connection string available");

            DbConnection connection = this._dbFactory.CreateConnection();
            connection.ConnectionString = connectionString;
            connection.Open();
            return connection;
        }

        private void SetDAConnection(DbConnection connection)
        {
            if (this._dbAdapter == null)
                return;
            this._dbAdapter.SelectCommand.Connection = connection;
            this._dbAdapter.UpdateCommand.Connection = connection;
            this._dbAdapter.InsertCommand.Connection = connection;
            this._dbAdapter.DeleteCommand.Connection = connection;
        }

        public int Save()
        {
            if (this._dbConnection != null)
            {
                this.SetDAConnection(this._dbConnection);
                return this._dbAdapter.Update(this);
            }
            else if (this._connectionString != null)
            {
                return this.Save(this._connectionString);
            }

            throw new Exception("No valid DB Connection");
        }

        public int Save(string connectionString)
        {
            DbConnection connection = this.GetOpenConnection(connectionString);
            this.SetDAConnection(connection);
            int rows = this._dbAdapter.Update(this);
            connection.Close();
            return rows;
        }

        public int Save(DbConnection connection)
        {
            this.SetDAConnection(connection);
            return this._dbAdapter.Update(this);
        }

        public bool TableExists()
        {
            if (this._dbConnection != null)
            {
                return this.TableExists(this._dbConnection);
            }
            else if (this._connectionString != null)
            {
                return this.TableExists(this._connectionString);
            }

            throw new Exception("No valid DB Connection");
        }

        public bool TableExists(string connectionString)
        {
            DbConnection connection = this.GetOpenConnection(connectionString);
            bool bRet = this.TableExists(connection);
            connection.Close();
            return bRet;
        }

        public bool TableExists(DbConnection connection)
        {
            DataTable dt = connection.GetSchema("TABLES", new string[] { "", "", "column_cache" });
            if (dt.Rows.Count > 0)
                return true;
            return false;
        }

        public void CreateTable()
        {
            if (this._dbConnection != null)
            {
                this.CreateTable(this._dbConnection);
            }
            else if (this._connectionString != null)
            {
                this.CreateTable(this._connectionString);
            }
            else
                throw new Exception("No valid DB Connection");
        }

        public void CreateTable(string connectionString)
        {
            DbConnection connection = this.GetOpenConnection(connectionString);
            this.CreateTable(connection);
            connection.Close();
        }

		protected virtual string GetColumnSpecification()
		{
			return "(table_name varchar(255), column_name varchar(255), ordinal_position integer, data_type varchar(255), column_length int, is_nullable bool, primary_key bool, PRIMARY KEY(table_name, column_name))";
		}
		
        public void CreateTable(DbConnection connection)
        {
            string sqlDrop = "DROP TABLE column_cache";
            string sqlCreate = "CREATE TABLE column_cache " + this.GetColumnSpecification();

            DbCommand commandDrop = this._dbFactory.CreateCommand();
            commandDrop.CommandText = sqlDrop;
            commandDrop.Connection = connection;

            DbCommand commandCreate = this._dbFactory.CreateCommand();
            commandCreate.CommandText = sqlCreate;
            commandCreate.Connection = connection;

            try
            {
                commandDrop.ExecuteNonQuery();
                commandDrop.Dispose();
            }
            catch (Exception)
            {
                commandDrop.Dispose();
            }

            commandCreate.ExecuteNonQuery();
            commandCreate.Dispose();
        }

        public void TruncateTable()
        {
            if (this._dbConnection != null)
            {
                this.TruncateTable(this._dbConnection);
            }
            else if (this._connectionString != null)
            {
                this.TruncateTable(this._connectionString);
            }
            else
                throw new Exception("No valid DB Connection");
        }

        public void TruncateTable(string connectionString)
        {
            DbConnection connection = this.GetOpenConnection(connectionString);
            this.TruncateTable(connection);
            connection.Close();
        }

        public void TruncateTable(DbConnection connection)
        {
            string sqlTruncate = "DELETE FROM column_cache";
            DbCommand commandTruncate = this._dbFactory.CreateCommand();
            commandTruncate.Connection = connection;
            commandTruncate.CommandText = sqlTruncate;
            commandTruncate.ExecuteNonQuery();
            commandTruncate.Dispose();
        }

        public ColumnCacheDataRow NewDBRow()
        {
            return (ColumnCacheDataRow)base.NewRow();
        }

        protected override DataRow NewRowFromBuilder(DataRowBuilder builder)
        {
            return new ColumnCacheDataRow(builder);
        }

        public int FillQuery(string query)
        {
            if (this._dbConnection != null)
            {
                return this.FillQuery(query, this._dbConnection);
            }
            else if (this._connectionString != null)
            {
                return this.FillQuery(query, this._connectionString);
            }

            throw new Exception("No valid SqliteConnection");
        }

        public int FillQuery(string query, string connectionString)
        {
            DbConnection connection = this.GetOpenConnection(connectionString);
            int iRet = this.FillQuery(query, connection);
            connection.Close();
            return iRet;
        }

        public int FillQuery(string query, DbConnection connection)
        {
            this.GenerateFillQueryDA(query);
            this.SetDAConnection(connection);
            return this._dbAdapter.Fill(this);
        }

        private void GenerateFillQueryDA(string query)
        {
            if (this._dbAdapter == null)
                this._dbAdapter = this._dbFactory.CreateDataAdapter();

            string selectQuery = "SELECT table_name  , column_name  , ordinal_position  , data_type , column_length , is_nullable  , primary_key FROM column_cache";

            if (query != null && query.Length > 0)
                selectQuery += " WHERE " + query;

            if (this._dbAdapter.SelectCommand != null)
                this._dbAdapter.SelectCommand.Dispose();

            this._dbAdapter.SelectCommand = this._dbFactory.CreateCommand();
            this._dbAdapter.SelectCommand.CommandText = selectQuery;
        }

        private void GenerateUpdateDA()
        {
            if (this._dbAdapter == null)
                this._dbAdapter = this._dbFactory.CreateDataAdapter();


            if (this._dbAdapter.UpdateCommand != null)
                this._dbAdapter.UpdateCommand.Dispose();

            this._dbAdapter.UpdateCommand = this._dbFactory.CreateCommand();
            this._dbAdapter.UpdateCommand.CommandText = "UPDATE column_cache SET ordinal_position = @ordinal_position , data_type = @data_type , column_length = @column_length,is_nullable = @is_nullable , primary_key = @primary_key WHERE table_name = @w_table_name AND column_name = @w_column_name";

            
            DbParameter ordinal_positionUpdateParam = this._dbFactory.CreateParameter();
            ordinal_positionUpdateParam.ParameterName = "@ordinal_position";
            ordinal_positionUpdateParam.SourceColumn = "ordinal_position";
            ordinal_positionUpdateParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.UpdateCommand.Parameters.Add(ordinal_positionUpdateParam);
            
            DbParameter data_typeUpdateParam = this._dbFactory.CreateParameter();
            data_typeUpdateParam.ParameterName = "@data_type";
            data_typeUpdateParam.SourceColumn = "data_type";
            data_typeUpdateParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.UpdateCommand.Parameters.Add(data_typeUpdateParam);

            DbParameter column_lengthUpdateParam = this._dbFactory.CreateParameter();
            column_lengthUpdateParam.ParameterName = "@column_length";
            column_lengthUpdateParam.SourceColumn = "column_length";
            column_lengthUpdateParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.UpdateCommand.Parameters.Add(column_lengthUpdateParam);

            DbParameter is_nullableUpdateParam = this._dbFactory.CreateParameter();
            is_nullableUpdateParam.ParameterName = "@is_nullable";
            is_nullableUpdateParam.SourceColumn = "is_nullable";
            is_nullableUpdateParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.UpdateCommand.Parameters.Add(is_nullableUpdateParam);
            
            DbParameter primary_keyUpdateParam = this._dbFactory.CreateParameter();
            primary_keyUpdateParam.ParameterName = "@primary_key";
            primary_keyUpdateParam.SourceColumn = "primary_key";
            primary_keyUpdateParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.UpdateCommand.Parameters.Add(primary_keyUpdateParam);
            
            
            
            DbParameter table_nameUpdateParam = this._dbFactory.CreateParameter();
            table_nameUpdateParam.ParameterName = "@w_table_name";
            table_nameUpdateParam.SourceColumn = "table_name";
            table_nameUpdateParam.SourceVersion = System.Data.DataRowVersion.Original;
            this._dbAdapter.UpdateCommand.Parameters.Add(table_nameUpdateParam);
            
            DbParameter column_nameUpdateParam = this._dbFactory.CreateParameter();
            column_nameUpdateParam.ParameterName = "@w_column_name";
            column_nameUpdateParam.SourceColumn = "column_name";
            column_nameUpdateParam.SourceVersion = System.Data.DataRowVersion.Original;
            this._dbAdapter.UpdateCommand.Parameters.Add(column_nameUpdateParam);
            

            if (this._dbAdapter.DeleteCommand != null)
                this._dbAdapter.DeleteCommand.Dispose();

            this._dbAdapter.DeleteCommand = this._dbFactory.CreateCommand();
            this._dbAdapter.DeleteCommand.CommandText = "DELETE FROM column_cache WHERE table_name = @w_table_name AND column_name = @w_column_name";

            
            DbParameter table_nameDeleteParam = this._dbFactory.CreateParameter();
            table_nameDeleteParam.ParameterName = "@w_table_name";
            table_nameDeleteParam.SourceColumn = "table_name";
            table_nameDeleteParam.SourceVersion = System.Data.DataRowVersion.Original;
            this._dbAdapter.DeleteCommand.Parameters.Add(table_nameDeleteParam);
            
            DbParameter column_nameDeleteParam = this._dbFactory.CreateParameter();
            column_nameDeleteParam.ParameterName = "@w_column_name";
            column_nameDeleteParam.SourceColumn = "column_name";
            column_nameDeleteParam.SourceVersion = System.Data.DataRowVersion.Original;
            this._dbAdapter.DeleteCommand.Parameters.Add(column_nameDeleteParam);
            

            if (this._dbAdapter.InsertCommand != null)
                this._dbAdapter.InsertCommand.Dispose();

            this._dbAdapter.InsertCommand = this._dbFactory.CreateCommand();
            this._dbAdapter.InsertCommand.CommandText = "INSERT INTO column_cache (table_name , column_name , ordinal_position , data_type , column_length, is_nullable , primary_key) VALUES(@table_name , @column_name , @ordinal_position , @data_type ,@column_length, @is_nullable , @primary_key)";

            
            DbParameter table_nameInsertParam = this._dbFactory.CreateParameter();
            table_nameInsertParam.ParameterName = "@table_name";
            table_nameInsertParam.SourceColumn = "table_name";
            table_nameInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(table_nameInsertParam);
            
            DbParameter column_nameInsertParam = this._dbFactory.CreateParameter();
            column_nameInsertParam.ParameterName = "@column_name";
            column_nameInsertParam.SourceColumn = "column_name";
            column_nameInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(column_nameInsertParam);
            
            DbParameter ordinal_positionInsertParam = this._dbFactory.CreateParameter();
            ordinal_positionInsertParam.ParameterName = "@ordinal_position";
            ordinal_positionInsertParam.SourceColumn = "ordinal_position";
            ordinal_positionInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(ordinal_positionInsertParam);
            
            DbParameter data_typeInsertParam = this._dbFactory.CreateParameter();
            data_typeInsertParam.ParameterName = "@data_type";
            data_typeInsertParam.SourceColumn = "data_type";
            data_typeInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(data_typeInsertParam);

            DbParameter column_lengthInsertParam = this._dbFactory.CreateParameter();
            column_lengthInsertParam.ParameterName = "@column_length";
            column_lengthInsertParam.SourceColumn = "column_length";
            column_lengthInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(column_lengthInsertParam);

            DbParameter is_nullableInsertParam = this._dbFactory.CreateParameter();
            is_nullableInsertParam.ParameterName = "@is_nullable";
            is_nullableInsertParam.SourceColumn = "is_nullable";
            is_nullableInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(is_nullableInsertParam);
            
            DbParameter primary_keyInsertParam = this._dbFactory.CreateParameter();
            primary_keyInsertParam.ParameterName = "@primary_key";
            primary_keyInsertParam.SourceColumn = "primary_key";
            primary_keyInsertParam.SourceVersion = System.Data.DataRowVersion.Current;
            this._dbAdapter.InsertCommand.Parameters.Add(primary_keyInsertParam);
            
        }

        public int FillKeys(string table_name, string column_name)
        {
            if (this._dbConnection != null)
            {
                return this.FillKeys(table_name, column_name, this._dbConnection);
            }
            else if (this._connectionString != null)
            {
                return this.FillKeys(table_name, column_name, this._connectionString);
            }

            throw new Exception("No valid DB Connection");
        }

        public int FillKeys(string table_name, string column_name, string connectionString)
        {
            DbConnection connection = this.GetOpenConnection(connectionString);
            int iRet = this.FillKeys(table_name, column_name, connection);
            connection.Close();
            return iRet;
        }

        public int FillKeys(string table_name, string column_name, DbConnection connection)
        {
            this.GenerateFillKeyDA(table_name, column_name);
            this.SetDAConnection(connection);
            return this._dbAdapter.Fill(this);
        }

        private void GenerateFillKeyDA(string table_name, string column_name)
        {
            if (this._dbAdapter == null)
                this._dbAdapter = this._dbFactory.CreateDataAdapter();

            string selectQuery = "SELECT table_name, column_name, ordinal_position, data_type, column_length, is_nullable, primary_key FROM column_cache WHERE table_name = @w_table_name AND column_name = @w_column_name";
            if (this._dbAdapter.SelectCommand != null)
                this._dbAdapter.SelectCommand.Dispose();

            this._dbAdapter.SelectCommand = this._dbFactory.CreateCommand();
            this._dbAdapter.SelectCommand.CommandText = selectQuery;

            
            DbParameter table_nameSelectParam = this._dbFactory.CreateParameter();
            table_nameSelectParam.ParameterName = "@w_table_name";
            table_nameSelectParam.Value = table_name;
            this._dbAdapter.SelectCommand.Parameters.Add(table_nameSelectParam);
            
            DbParameter column_nameSelectParam = this._dbFactory.CreateParameter();
            column_nameSelectParam.ParameterName = "@w_column_name";
            column_nameSelectParam.Value = column_name;
            this._dbAdapter.SelectCommand.Parameters.Add(column_nameSelectParam);
            
        }
    }
}
